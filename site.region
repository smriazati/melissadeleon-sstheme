<!doctype html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

    <!-- include system scripts, page meta, and header code injection -->
    {squarespace-headers}
    
  </head>
  <body id="{squarespace.page-id}" class="{squarespace.page-classes}">

    <div class="site-container">

      <header class="site-header">
        <!-- site navigation -->
        <squarespace:navigation navigationId="siteNav" template="site-navigation" />

        <!-- site title or logo -->
        {.section website}
          <div class="site-logo">
            <a href="/" class="site-title-link">
              <img src="{logoImageUrl}" alt="melissa de leon logo" />
            </a>
          </div>
          <h1 class="visually-hidden site-title-heading" data-content-field="site-title">
            <a href="/" class="site-title-link">{siteTitle}</a>
          </h1>
        {.end}
      </header>

      <!-- cms content injection point -->
      <main class="content-container" role="main" data-content-field="main-content">
       {squarespace.main-content}
      </main>

      <!--Footer with open block field -->
      <footer class="site-footer">
        <div class="footer-social">
          <div class="text-wrapper">
            <h3>Follow</h3>
            <p><a href="https://www.instagram.com/melissadeleonstyling/" target="_blank">@MelissadeLeonStyling</a></p>
          </div>
        </div>
        <div class="footer-nav">
          {#  <squarespace:block-field id="footerBlocks" columns="1" />  }
            <ul>
              <li><a href="/about">About</a></li>
              <li><a href="/offerings">Offerings</a></li>
              <li><a href="/contact">Contact</a></li>
              <li><a href="/press">Press</a></li>
              <li><a href="/clients">Client Portal</a></li>
            </ul>
        </div>
        <nav class="footer-cta">
          <a href="/the-edit" class="text-wrapper">
            <h3>Get Inspired, Learn and Shop</h3>
            <p>The Edit</p>
          </a>
        </nav>
        <div class="footer-copyright">
          <p>Â© <span id="copyrightYear"></span> Melissa de Leon Styling. <a href="https://www.otherlove.co/" target="_blank">Made with Otherlove.</a></p>
        </div>
        <a href="/the-edit" class="footer-icon">
            <div class="icon">
              <img src="/assets/icons/arrow.png" alt="white arrow surrounded by a circle pointing to the right" />
          </div>
        </a>
      </footer>

    </div>

    <!-- combo and minify scripts when not logged in -->
    <squarespace:script src="blocks-classes.min.js" combo="{.if authenticatedAccount}false{.or}true{.end}" />

    <squarespace:script src="site.js" combo="{.if authenticatedAccount}false{.or}true{.end}" />

    <!-- other scripts, and footer code injection -->
    {squarespace-footers}

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.1/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.1/CSSRulePlugin.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.1/ScrollTrigger.min.js"></script>
  <script>
    const ssData = {@|json};
    // ssData.collection.urlId
    function printYear() {
      var d = new Date();
      var n = d.getFullYear();
      document.getElementById("copyrightYear").innerHTML = n;
    }
    

    // offerings page > captions are links
    function convertCaptionsIntoLinks() {
      const captions = document.querySelectorAll('main figcaption.image-caption-wrapper');
      {#  console.log(captions);  }
      captions.forEach(c => {
        const href = c.previousElementSibling.getAttribute("href");
        var caption = c.querySelector('.image-caption');
        const captionText = caption.outerHTML;

        if (href && captionText) {
          var a = document.createElement('a');
          a.href = href;
          a.classList.add('caption-wrapper-link')
          a.innerHTML = captionText;

          c.insertBefore(a, caption);
          caption.remove();
          
        }
      })
    }

    function checkForAccordion() {
      const accordion = document.querySelector('.accordion');
      if (accordion) {
        return true;
      } else {
        return false;
      }
    }

    function activateAccordion() {
      const accordions = document.querySelectorAll('main .accordion');
      accordions.forEach(accordion => {
        const items = accordion.querySelectorAll('.accordion-item');
        items.forEach(item => {
          item.addEventListener('click', event => {
            if (item.classList.contains('closed')) {
              item.classList.add('open');
              item.classList.remove('closed');
            } else {
              item.classList.add('closed');
              item.classList.remove('open');
            }
          })
        })
      })
    }

    function checkForFeaturedSinglePage() {
      const isFeatured = document.querySelectorAll('article.featured');
      const hasBlogItem = document.querySelectorAll('.blog-item');
      if (isFeatured.length > 0 && hasBlogItem.length > 0) {
        return true;
      } else {
        return false;
      }
    }

    function homePageCustomStyles() {

      {#  CARDS  }
      const cards = document.querySelectorAll('.card');
      cards.forEach( card => {
        const caption = card.querySelector('figcaption .image-caption p');
        var captionText = caption.textContent;
        const firstTwoWords = captionText.split(' ').slice(0,2).join(' ');
      
        const emTag = document.createElement('em');
        emTag.innerHTML = firstTwoWords;

        caption.innerHTML = emTag.outerHTML + captionText.replace(firstTwoWords.toString(), '');
      })

      {#  Shrink Logo On Scroll  }

    }


    gsap.registerPlugin(ScrollTrigger);

    ScrollTrigger.defaults({
      toggleActions: "play play resume reset"
    });

  function showDescriptionAsOverlay() {
    const summary = document.querySelector('.summary-block-collection-type-commercialGallery');
    const thumbs = summary.querySelectorAll('.summary-thumbnail-container');
    thumbs.forEach( thumb => {
      const description = thumb.dataset.description;
      const newDiv = document.createElement('div');
      newDiv.innerHTML = description;
      newDiv.classList.add('thumbnail-description')
      thumb.insertBefore(newDiv, thumb.firstChild);
    })    
  }

    function shrinkLogoOnScroll() {
      const header = document.querySelector('.site-header');
      const logo = header.querySelector('.site-logo');
      const navItems = header.querySelectorAll('.site-navigation-item');
      const hero = document.querySelector('.hero')
      logo.style.width = '430px';
      gsap.to(logo, {
          scrollTrigger: {
            trigger: hero,
            start: "bottom top", 
            end: "+=300",
          },
          'width': '220px'
      });
      navItems.forEach(navItem => {
          gsap.to(navItem, {
            scrollTrigger: {
              trigger: hero,
              start: "bottom top", 
              end: "+=300",
            },
            'padding-top': '15px',
            'padding-bottom': '15px'
        });
      });
    }

    function homePageCards() {
      const trigger = document.querySelector('main .submark-headline');
      const refs = document.querySelectorAll('main .card');
      console.log(refs);
      refs.forEach(card => {
          gsap.to(card, {
            scrollTrigger: {
              trigger: trigger,
              start: "top 10%", 
              scrub: .3
            },
            y: '-50vh',
            'margin-bottom': '15px',
        });
      });
    }

    function addMarginForFixedHeader() {
      const header = document.querySelector('.site-header');
      if (header) {
        const hW = header.offsetHeight;
        const main = header.nextElementSibling;
        main.style.marginTop = hW + 'px';
      }
    }

    document.addEventListener("DOMContentLoaded", function(event) { 
      printYear();

      const currentPage = ssData.collection.urlId;
      document.querySelector('body').classList.add(currentPage)

      if (currentPage === 'offerings') {
        convertCaptionsIntoLinks();
      }


      addMarginForFixedHeader();

      var hasAccordion = checkForAccordion();
      if (hasAccordion) {
        activateAccordion();
      }

      const summary = document.querySelector('.summary-block-collection-type-commercialGallery');
      if (summary) {
        showDescriptionAsOverlay();
      }

      var isFeaturedItem = checkForFeaturedSinglePage();
      if (isFeaturedItem) {
        document.querySelector('body').classList.add('featured-post')
      }

      if (currentPage === 'home') {
        homePageCustomStyles();
        shrinkLogoOnScroll();
        homePageCards();
      }

    });
    
  </script>
  </body>
</html>
